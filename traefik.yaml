services:
  traefik:
    image: traefik:latest
    container_name: traefik
    restart: unless-stopped
    command:
      - "--api.insecure=true"
      - "--api.dashboard=true"
      - "--entrypoints.web.address=:80"
      - "--entrypoints.websecure.address=:443"
      - "--providers.docker=true"
      - "--providers.file.directory=/traefik/dynamic"
      - "--providers.file.watch=true"
      - "--certificatesresolvers.le.acme.storage=/traefik/letsencrypt/acme.json"
      - "--certificatesresolvers.le.acme.httpchallenge.entrypoint=web"
    ports:
      - "80:80"
      - "443:443"
      - "81:8080"  # Dashboard mapped to host port 81
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      - "traefik_data:/traefik/data"
      - "traefik_letsencrypt:/traefik/letsencrypt"
      - "traefik_dynamic:/traefik/dynamic"
    networks:
      proxy-network:
        ipv4_address: 172.20.0.100

volumes:
  traefik_data:
    driver_opts:
      o: bind
      type: none
      device: /mnt/quick/apps/volumes/traefik/data
  traefik_letsencrypt:
    driver_opts:
      o: bind
      type: none
      device: /mnt/quick/apps/volumes/traefik/letsencrypt
  traefik_dynamic:
    driver_opts:
      o: bind
      type: none
      device: /mnt/quick/apps/volumes/traefik/dynamic

networks:
  proxy-network:
    name: homelab-network
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/24
          gateway: 172.20.0.1